# Тестовое задание ПTMK

Это консольное приложение на C++, разработанное в рамках тестового задания ПTMK. Приложение взаимодействует с базой данных PostgreSQL с использованием библиотеки libpqxx. Оно поддерживает несколько режимов работы для управления справочником сотрудников, включая создание таблиц, добавление записей, отображение данных, массовую вставку и выполнение запросов с замером времени.

## Возможности

- **Режим 1**: создание таблицы `employees` в базе данных PostgreSQL с полями для ФИО, даты рождения и пола.
- **Режим 2**: добавление одной записи сотрудника с данными, переданными через аргументы командной строки.
- **Режим 3**: вывод всех уникальных записей сотрудников, отсортированных по ФИО, с указанием возраста.
- **Режим 4**: автоматическое заполнение таблицы 1 000 000 случайных записей сотрудников (с равномерным распределением пола и начальных букв) и добавление 100 записей для мужчин с фамилией, начинающейся на 'F'.
- **Режим 5**: выборка сотрудников мужского пола с фамилией, начинающейся на 'F', с замером времени выполнения.

Приложение использует объектно-ориентированный подход с классом `Employee`, который содержит методы для сохранения данных в базу единичной записи, множества записей и расчёта возраста.

## Требования

- Компилятор MSVC с поддержкой C++ 20.
- Сервер базы данных PostgreSQL (рекомендуется версия 17).
- **Библиотека libpqxx**: Обязательная зависимость для работы с PostgreSQL в C++ в этом приложении.
- Доступ к базе данных PostgreSQL. При необходимости измените в `main.cpp`, при проблемах с зависимостями, например версия Postgres, изменять в CMake файле.

## Использование

Запустите приложение из консоли, указав режим работы первым аргументом. Примеры:

- **Режим 1**: создание таблицы
  ```
  ./myApp 1
  ```

- **Режим 2**: добавление записи
  ```
  ./myApp 2 "Ivanov Petr Sergeevich" 2009-07-12 Male
  ```

- **Режим 3**: вывод всех уникальных записей
  ```
  ./myApp 3
  ```

- **Режим 4**: массовая вставка 1 000 000 + 100 записей
  ```
  ./myApp 4
  ```

- **Режим 5**: запрос с замером времени
  ```
  ./myApp 5
  ```

## Оптимизация

Для оптимизации поле sex было изменено с VARCHAR(10) на ENUM ('Male', 'Female'), а так же добавлен запрос ANALYZE employees перед основным запросом пятого режима. ANALYZE employees позволяет планировщику Postgres собрать актуальную статистику о состоянии таблицы, это необходимо после вставки более миллиона записей, актуальная статистика повышает скорость выполнения запроса.<br />
Время выполнения до оптимизации: SQL execution time: 0.144465 seconds.<br />
До: <br />
![alt text](https://github.com/R031-E/ptmk_test/blob/master/before.png "До")<br />
Время выполнения после оптимизации: SQL execution time: 0.0683141 seconds.<br />
После: <br />
![alt text](https://github.com/R031-E/ptmk_test/blob/master/after.png "После")
## Примечания

- ФИО записываются на английском языке.
- Генерация случайных данных в режиме 4 обеспечивает относительно равномерное распределение полов и начальных букв.
- Обработка ошибок минимальна; убедитесь, что подключение к базе данных корректно.

При возникновении проблем проверьте права доступа к базе данных или установку libpqxx.
